---
title: "Environmental drivers of white plague disease on shallow and mesophotic coral reefs, U.S. Virgin Islands"
subtitel: "Residual diagnosis"
author: "Andia Chaves-Fonnegra, Bernd Panassiti, Tyler B. Smith, Elizabeth Brown, Elizabeth Clemens, Moriah Sevier, and Marilyn Brandt"
date: 'created: 25/07/2017, last modified: `r format(Sys.Date(), format="%d.%m.%Y")`'
output: pdf_document
---

```{r setup, include=FALSE, warnings=FALSE}
library(knitr)
opts_knit$set(root.dir='../')                     # definining working directory; or normalizePath('../')
opts_chunk$set(fig.align='center',                # aligns all figures
                echo=TRUE,                        # shows r-code
                message=FALSE,                    # suppresses library outputs
                warnings=FALSE,                   # suppresses library outputs
                tidy=TRUE,  # prevents the source code from running off a pdf page
                dev='pdf')                        # pdf device
```


# Environmental drivers of white plague disease on shallow and mesophotic coral reefs, U.S. Virgin Islands - Residual analysis

## Introduction
This document provides residual diagnosis for the logistic regression model using Bayesian inference for the White plaque disease on corals described in the article: ``Identifying local drivers of a vector-pathogen-disease system using Bayesian modeling''.
The Skript is based on the residuals analysis provided in Panassiti et al., 2016.

## Data






## Residual analysis


#### Loading data & libraries
```{r}
rm(list=ls(all=TRUE))
load(file="data/whiteplaque_workingdata.Rdata")

NameOfModelRun <- "2017.07.26_Whiteplaque_model_result"
load(file=paste("data/",NameOfModelRun,"_graphinput.RData",sep=""))

#devtools::install_github(repo = "DHARMa", username = "florianhartig", subdir = "DHARMa", dependencies = T, build_vignettes = TRUE)
library(DHARMa)
```


#### Create DHARMa object
```{r,echo=FALSE}
# Symptomatic corals - Response scale - inv.logit
WhitePlaqueDHARMaResponse <- createDHARMa(simulatedResponse = simulatedPredictedWhitePlaque,
  observedResponse = observedWhitePlaque,fittedPredictedResponse = predictionsResponseMedianWhitePlaque,integerResponse = T)
```



#### Plot DHARMa object
```{r}
plotSimulatedResiduals(simulationOutput = WhitePlaqueDHARMaResponse)
```

#### Spatial autocorrelation
```{r}
#test Spatial autocorrelation Moran's I
scaledResiduals <- WhitePlaqueDHARMaResponse$scaledResiduals

testSpatialAutocorrelation(simulationOutput = WhitePlaqueDHARMaResponse, x = White1$Latitude,y = White1$Longitude)
```

